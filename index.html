<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dog Snack Bar: Garden Tycoon</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');

        :root {
            --grass-color: #b8d8be;
            --road-color: #a8a29e;
            --house-wall: #ffadad;
            --house-roof: #ff85a1;
            --ui-bg: #fffbf0;
            --btn-orange: #ffb703;
            --btn-blue: #8ecae6;
            --text-dark: #4a4e69;
        }

        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #222;
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        #app {
            width: 100%;
            max-width: 450px; /* Mobile width */
            background-color: var(--grass-color);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        /* --- SCENERY (CSS ART) --- */
        #scenery-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .road {
            position: absolute;
            top: 180px; left: 0; width: 100%; height: 60px;
            background: var(--road-color);
            border-top: 4px solid #888;
            border-bottom: 4px solid #888;
        }

        /* The House */
        .house-container {
            position: absolute;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            width: 280px; height: 180px;
        }
        .house-roof {
            width: 0; height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-bottom: 100px solid var(--house-roof);
            position: absolute; top: 0; left: -10px;
            filter: drop-shadow(0 5px 0 rgba(0,0,0,0.1));
        }
        .house-wall {
            width: 240px; height: 100px;
            background: var(--house-wall);
            position: absolute; bottom: 0; left: 20px;
            border: 4px solid #e56b6f;
            border-bottom: none;
            display: flex; justify-content: center; align-items: flex-end;
        }
        .door {
            width: 60px; height: 80px;
            background: #6d4c41;
            border: 3px solid #3e2723;
            border-radius: 5px 5px 0 0;
        }

        /* Trees */
        .tree {
            position: absolute;
            z-index: 50; /* Above road, below UI */
        }
        .tree-top {
            width: 80px; height: 80px;
            background: #55a630;
            border-radius: 50%;
            border: 4px solid #2b5c12;
            box-shadow: inset -10px -10px 0 rgba(0,0,0,0.1);
        }

        /* --- GAME ENTITIES --- */
        #game-layer {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        .entity {
            position: absolute;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: top 0.1s linear, left 0.1s linear;
        }
        
        .shadow {
            position: absolute; bottom: 0;
            width: 30px; height: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 50%;
        }

        .sprite {
            font-size: 2.5rem;
            position: relative; bottom: 5px;
            z-index: 2;
        }

        /* Stations (Kitchen) */
        .station-area {
            position: absolute;
            width: 70px; height: 90px;
            display: flex; flex-direction: column; align-items: center;
        }
        .machine {
            width: 50px; height: 50px;
            background: #a98467;
            border: 3px solid #5d4037;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            position: relative;
            box-shadow: 0 4px 0 #3e2723;
        }
        .machine::after { /* Smoke/Steam hint */
            content: ''; position: absolute; top: -10px; right: -5px;
            width: 10px; height: 10px; background: #fff; border-radius: 50%; opacity: 0.5;
        }

        /* The Checkered Serving Tables (From Screenshot) */
        .serving-table {
            position: absolute;
            width: 100px; height: 40px;
            background-color: #fff;
            background-image: 
                linear-gradient(45deg, #ffcdb2 25%, transparent 25%, transparent 75%, #ffcdb2 75%, #ffcdb2), 
                linear-gradient(45deg, #ffcdb2 25%, transparent 25%, transparent 75%, #ffcdb2 75%, #ffcdb2);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
            border: 2px solid #e5989b;
            border-radius: 6px;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
        }
        .serving-table.blue {
            background-image: 
                linear-gradient(45deg, #bde0fe 25%, transparent 25%, transparent 75%, #bde0fe 75%, #bde0fe), 
                linear-gradient(45deg, #bde0fe 25%, transparent 25%, transparent 75%, #bde0fe 75%, #bde0fe);
            border-color: #a2d2ff;
        }

        /* Bubbles */
        .bubble {
            position: absolute; top: -50px;
            background: #fff; padding: 5px 10px;
            border-radius: 15px;
            border: 2px solid #333;
            font-weight: bold; font-size: 0.9rem;
            white-space: nowrap; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            display: flex; align-items: center; gap: 5px;
        }
        .bubble::after {
            content: ''; position: absolute; bottom: -6px; left: 50%; margin-left: -6px;
            border-width: 6px 6px 0; border-style: solid; border-color: #333 transparent;
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

        /* --- UI OVERLAY --- */
        #top-ui {
            position: absolute; top: 10px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 10px;
            z-index: 200;
        }
        .resource-pill {
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #e5e5e5;
            display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            color: var(--text-dark);
            font-weight: 800;
            font-size: 1.1rem;
        }

        #bottom-ui {
            height: 220px;
            background: var(--ui-bg);
            border-top: 4px solid #f0e6d2;
            display: flex; flex-direction: column;
            z-index: 200;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        .tab-bar { display: flex; padding: 10px 10px 0 10px; gap: 5px; }
        .tab {
            flex: 1; text-align: center; padding: 12px;
            background: #eee; border-radius: 10px 10px 0 0;
            font-weight: bold; color: #888; cursor: pointer;
            border-bottom: 4px solid transparent;
        }
        .tab.active {
            background: #fff; color: var(--text-dark);
            border-bottom: 4px solid var(--btn-orange);
        }

        #panel {
            flex: 1; padding: 10px; overflow-y: auto; background: #fff;
        }

        .card {
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; border: 2px solid #f0f0f0;
            padding: 10px; margin-bottom: 10px; border-radius: 12px;
        }
        .btn {
            background: var(--btn-orange); color: #fff; border: none;
            padding: 10px 20px; border-radius: 10px;
            font-weight: bold; font-family: inherit;
            box-shadow: 0 4px 0 #e08e00; cursor: pointer;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn.disabled { filter: grayscale(1); opacity: 0.5; pointer-events: none; }

        /* Floating text */
        .floater {
            position: absolute; font-weight: 900;
            color: var(--btn-orange); -webkit-text-stroke: 1px #fff;
            animation: floatUp 1s forwards; pointer-events: none; z-index: 999;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }

    </style>
</head>
<body>

<div id="app">
    <div id="scenery-layer">
        <div class="house-container">
            <div class="house-roof"></div>
            <div class="house-wall">
                <div class="door"></div>
            </div>
        </div>
        <div class="road"></div>
        <div id="trees-container"></div>
    </div>

    <div id="top-ui">
        <div class="resource-pill">
            <span style="font-size:1.2rem">ü¶¥</span> <span id="money">0</span>
        </div>
        <div class="resource-pill">
            <span style="font-size:1.2rem">üíé</span> <span id="gems">10</span>
        </div>
    </div>

    <div id="game-layer">
        </div>

    <div id="bottom-ui">
        <div class="tab-bar">
            <div class="tab active" onclick="setTab('stations')">Kitchen</div>
            <div class="tab" onclick="setTab('staff')">Staff</div>
        </div>
        <div id="panel">
            </div>
    </div>
</div>

<script>
/**
 * üé® DOG SNACK BAR: GRAPHIC EDITION
 * Logic: Tycoon Style (Chef cooks -> Counter -> Server/Chef delivers -> Customer eats)
 */

// --- ASSETS & CONFIG ---
const STATIONS = [
    { id: 0, name: "Donut", emoji: "üç©", basePrice: 15, time: 1000, x: 80, y: 400, color: "blue" },
    { id: 1, name: "Coffee", emoji: "‚òï", basePrice: 150, time: 2500, x: 280, y: 400, color: "pink" }
];

// Visual "Checkered Tables" (Counters) relative to stations
// In the screenshot, the checkered tables are where the food sits.
const COUNTERS = [
    { x: 50, y: 320, width: 130, color: "blue" }, // For Donut
    { x: 250, y: 320, width: 130, color: "pink" }  // For Coffee
];

// Eating Tables (Scattered on grass)
const TABLES = [
    { id: 0, x: 60, y: 550 },
    { id: 1, x: 300, y: 550 },
    { id: 2, x: 180, y: 650 }
];

// --- STATE ---
let state = {
    money: 0,
    gems: 10,
    levels: [1, 0], // Station levels
    staff: [
        { type: 'chef', x: 80, y: 400, state: 'IDLE', speed: 3 }, // Start with 1 chef
        { type: 'server', x: 200, y: 500, state: 'IDLE', speed: 4 } // Start with 1 server (Reference image has servers)
    ]
};

let customers = [];
let orders = []; // { id, stationId, status: PENDING|COOKING|READY|SERVED, tableId }
let floaters = [];

// DOM
const gameLayer = document.getElementById('game-layer');
const panel = document.getElementById('panel');
const moneyEl = document.getElementById('money');
const treesContainer = document.getElementById('trees-container');

// --- INIT ---
function init() {
    createDecor();
    renderStaticGameElements();
    
    // Loops
    setInterval(gameLoop, 30); // 30fps physics
    setInterval(spawnCustomer, 3000); // Customer spawner
    setInterval(uiUpdate, 200); // UI Refresh
    
    uiUpdate();
}

function createDecor() {
    // Add trees (visual only)
    const treePositions = [
        {x: -40, y: 300}, {x: 380, y: 320}, 
        {x: -20, y: 600}, {x: 350, y: 700},
        {x: 360, y: 150}, {x: -50, y: 140}
    ];
    
    treePositions.forEach(pos => {
        let t = document.createElement('div');
        t.className = 'tree';
        t.style.left = pos.x + 'px';
        t.style.top = pos.y + 'px';
        t.innerHTML = `<div class="tree-top"></div>`;
        treesContainer.appendChild(t);
    });
}

function renderStaticGameElements() {
    // 1. Render Counters (The Checkered Tables)
    COUNTERS.forEach((c, idx) => {
        let el = document.createElement('div');
        el.className = `serving-table ${c.color === 'blue' ? 'blue' : ''}`;
        el.style.left = c.x + 'px';
        el.style.top = c.y + 'px';
        el.style.width = c.width + 'px';
        // Add ID so we can place food on it later
        el.id = `counter-${idx}`;
        gameLayer.appendChild(el);
    });

    // 2. Render Cooking Stations (Machines behind counters)
    STATIONS.forEach((s, idx) => {
        let el = document.createElement('div');
        el.className = 'station-area';
        el.style.left = s.x + 'px';
        el.style.top = s.y + 'px';
        
        let machine = document.createElement('div');
        machine.className = 'machine';
        machine.innerText = s.emoji;
        el.appendChild(machine);
        
        // Level Tag
        let tag = document.createElement('div');
        tag.id = `lvl-tag-${idx}`;
        tag.style.background = '#333'; tag.style.color='#fff'; 
        tag.style.padding='2px 6px'; tag.style.borderRadius='10px';
        tag.style.fontSize='0.7rem'; tag.style.marginTop='5px';
        tag.innerText = `Lvl ${state.levels[idx]}`;
        el.appendChild(tag);
        
        if(state.levels[idx] === 0) el.style.opacity = '0.4';
        
        gameLayer.appendChild(el);
    });

    // 3. Render Eating Tables
    TABLES.forEach(t => {
        let el = document.createElement('div');
        el.className = 'serving-table'; // Reuse style for simplicity, or make round
        el.style.borderRadius = '50%';
        el.style.width = '60px'; el.style.height = '60px';
        el.style.left = t.x + 'px';
        el.style.top = t.y + 'px';
        el.style.background = '#fff'; // White cloth
        el.style.border = '2px solid #ddd';
        gameLayer.appendChild(el);
    });
    
    // 4. Render Staff
    state.staff.forEach(s => createEntityDom(s));
}

function createEntityDom(ent) {
    let el = document.createElement('div');
    el.className = 'entity';
    
    // Shadow
    let sh = document.createElement('div');
    sh.className = 'shadow';
    el.appendChild(sh);
    
    // Sprite
    let sp = document.createElement('div');
    sp.className = 'sprite';
    // Chef = Cat with Hat (or Dog), Server = Dog with Bandana
    if(ent.type === 'chef') sp.innerText = 'üë®‚Äçüç≥'; 
    else if(ent.type === 'server') sp.innerText = 'üêï'; 
    else if(ent.type === 'customer') sp.innerText = ent.emoji;
    
    el.appendChild(sp);
    
    gameLayer.appendChild(el);
    ent.el = el;
    updateEntityPos(ent);
}

// --- LOGIC ---

function gameLoop() {
    // Staff Logic
    state.staff.forEach(member => {
        if(member.state === 'IDLE') {
            if(member.type === 'chef') assignChefJob(member);
            if(member.type === 'server') assignServerJob(member);
        }
        moveEntity(member);
    });

    // Customer Logic
    customers.forEach(c => {
        moveEntity(c);
        // Z-Index Sorting
        if(c.el) c.el.style.zIndex = Math.floor(c.y);
    });
    state.staff.forEach(s => { if(s.el) s.el.style.zIndex = Math.floor(s.y); });
}

function assignChefJob(chef) {
    // Find Pending Order
    let job = orders.find(o => o.status === 'PENDING' && state.levels[o.stationId] > 0 && !o.chefId);
    if(job) {
        job.chefId = chef;
        chef.state = 'MOVING';
        let st = STATIONS[job.stationId];
        
        // Move to Station
        setTarget(chef, st.x + 10, st.y + 10, () => {
            chef.state = 'COOKING';
            // Cook Animation
            setTimeout(() => {
                // Done Cooking, Move to Counter
                chef.state = 'MOVING';
                let ctr = COUNTERS[job.stationId];
                // Random spot on the counter
                let dropX = ctr.x + 20 + Math.random() * (ctr.width - 40);
                let dropY = ctr.y + 10;
                
                setTarget(chef, dropX, dropY + 40, () => {
                    // Place Food
                    job.status = 'READY';
                    job.foodX = dropX; job.foodY = dropY;
                    spawnFoodVisual(job);
                    
                    chef.state = 'IDLE'; // Job done
                });
            }, STATIONS[job.stationId].time); // Cook time
        });
    }
}

function assignServerJob(server) {
    // Find Ready Food
    let job = orders.find(o => o.status === 'READY' && !o.serverId);
    if(job) {
        job.serverId = server;
        server.state = 'MOVING';
        
        // Move to Food on Counter
        setTarget(server, job.foodX, job.foodY + 20, () => {
            // Pick up
            if(job.foodEl) job.foodEl.remove(); // Remove from counter
            
            // Deliver to Table
            let table = TABLES[job.tableId];
            server.state = 'MOVING';
            setTarget(server, table.x + 10, table.y, () => {
                // Delivered
                job.status = 'SERVED';
                customerEat(job);
                server.state = 'IDLE';
            });
        });
    }
}

function customerEat(order) {
    let cust = customers.find(c => c.tableId === order.tableId);
    if(cust) {
        // Change bubble to Yum
        if(cust.bubble) cust.bubble.innerText = 'üòã';
        
        setTimeout(() => {
            // Pay
            let amt = STATIONS[order.stationId].basePrice * state.levels[order.stationId];
            spawnFloater(cust.x, cust.y, `+${amt}`);
            state.money += amt;
            moneyEl.innerText = state.money;
            
            // Leave
            cust.bubble.remove();
            cust.state = 'MOVING';
            setTarget(cust, 220, 900, () => { // Walk off screen
                cust.el.remove();
                customers = customers.filter(c => c !== cust);
                // Free table
                // (In this simple version, tables free up when cust leaves)
            });
            
            // Remove order
            orders = orders.filter(o => o !== order);
            
        }, 2000);
    }
}

// --- MOVEMENT ---
function setTarget(ent, x, y, cb) {
    ent.targetX = x;
    ent.targetY = y;
    ent.onReach = cb;
}

function moveEntity(ent) {
    if(ent.state !== 'MOVING' && ent.state !== 'WALKING_IN') return;
    
    let dx = ent.targetX - ent.x;
    let dy = ent.targetY - ent.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    
    let speed = ent.speed || 2;
    
    if(dist < speed) {
        ent.x = ent.targetX;
        ent.y = ent.targetY;
        if(ent.onReach) {
            let cb = ent.onReach;
            ent.onReach = null;
            cb();
        }
    } else {
        ent.x += (dx/dist) * speed;
        ent.y += (dy/dist) * speed;
    }
    updateEntityPos(ent);
}

function updateEntityPos(ent) {
    if(ent.el) {
        ent.el.style.left = ent.x + 'px';
        ent.el.style.top = ent.y + 'px';
    }
}

// --- SPAWNING ---
function spawnCustomer() {
    // Find free table
    let occupied = customers.map(c => c.tableId);
    let freeTable = TABLES.find(t => !occupied.includes(t.id));
    
    if(freeTable) {
        let emojis = ['üê∂', 'üêï', 'üê©', 'üê∫', 'ü¶ä'];
        let c = {
            type: 'customer',
            emoji: emojis[Math.floor(Math.random()*emojis.length)],
            x: 220, y: 190, // Start on road
            targetX: freeTable.x + 10, targetY: freeTable.y - 30, // Sit at table
            tableId: freeTable.id,
            state: 'WALKING_IN',
            speed: 2
        };
        
        createEntityDom(c);
        customers.push(c);
        
        c.onReach = () => {
            c.state = 'SITTING';
            // Order
            let stationIdx = Math.floor(Math.random() * STATIONS.length);
            // Only order unlocked
            if(state.levels[stationIdx] === 0) stationIdx = 0; 
            
            orders.push({
                stationId: stationIdx,
                tableId: c.tableId,
                status: 'PENDING'
            });
            
            // Bubble
            let b = document.createElement('div');
            b.className = 'bubble';
            b.innerHTML = `${STATIONS[stationIdx].emoji} <span style="font-size:0.7em; color:#888">1</span>`;
            c.el.appendChild(b);
            c.bubble = b;
        }
    }
}

function spawnFoodVisual(job) {
    let el = document.createElement('div');
    el.style.position = 'absolute';
    el.innerText = STATIONS[job.stationId].emoji;
    el.style.fontSize = '1.5rem';
    el.style.left = job.foodX + 'px';
    el.style.top = job.foodY + 'px';
    el.style.zIndex = 100;
    el.style.animation = 'popIn 0.3s';
    gameLayer.appendChild(el);
    job.foodEl = el;
}

function spawnFloater(x, y, txt) {
    let f = document.createElement('div');
    f.className = 'floater';
    f.innerText = txt;
    f.style.left = x + 'px';
    f.style.top = (y - 50) + 'px';
    gameLayer.appendChild(f);
    setTimeout(() => f.remove(), 1000);
}

// --- UI ---
let currentTab = 'stations';

function setTab(t) {
    currentTab = t;
    uiUpdate();
    document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
    event.target.classList.add('active');
}

function uiUpdate() {
    panel.innerHTML = '';
    
    if(currentTab === 'stations') {
        STATIONS.forEach((s, idx) => {
            let lvl = state.levels[idx];
            let cost = Math.floor(s.basePrice * Math.pow(1.5, lvl));
            if(lvl === 0) cost = s.basePrice; // Unlock cost
            
            let card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="font-size:2rem">${s.emoji}</div>
                    <div>
                        <div style="font-weight:bold">${s.name}</div>
                        <div style="font-size:0.8rem; color:#888">Lvl ${lvl}</div>
                    </div>
                </div>
                <button class="btn ${state.money < cost ? 'disabled' : ''}" onclick="upgradeStation(${idx}, ${cost})">
                    ${lvl === 0 ? 'Unlock' : 'Up'} <br> ü¶¥${cost}
                </button>
            `;
            panel.appendChild(card);
        });
    } else {
        // Staff Tab
        let cost = 500 * state.staff.length;
        let card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div>
                <b>Hire Staff</b><br>
                <small>Current: ${state.staff.length}</small>
            </div>
            <button class="btn ${state.money < cost ? 'disabled' : ''}" onclick="hireStaff(${cost})">
                +1 üêï<br>ü¶¥${cost}
            </button>
        `;
        panel.appendChild(card);
    }
}

function upgradeStation(idx, cost) {
    if(state.money >= cost) {
        state.money -= cost;
        state.levels[idx]++;
        moneyEl.innerText = state.money;
        
        // Update visual tag
        let tag = document.getElementById(`lvl-tag-${idx}`);
        if(tag) tag.innerText = `Lvl ${state.levels[idx]}`;
        
        // Update opacity
        if(state.levels[idx] === 1) {
            // Re-render to show active
             // (Lazy refresh via init logic would be better, but we just fix opacity here)
             document.querySelectorAll('.station-area')[idx].style.opacity = '1';
        }
        
        uiUpdate();
    }
}

function hireStaff(cost) {
    if(state.money >= cost) {
        state.money -= cost;
        moneyEl.innerText = state.money;
        // Alternate Chef/Server
        let type = state.staff.filter(s => s.type === 'chef').length <= state.staff.filter(s => s.type === 'server').length ? 'chef' : 'server';
        
        let s = { type: type, x: 200, y: 200, state: 'IDLE', speed: 3 };
        state.staff.push(s);
        createEntityDom(s);
        uiUpdate();
    }
}

init();

</script>
</body>
</html>
